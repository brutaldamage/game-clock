<!DOCTYPE html>
<html>

    <body>
        <div id="turnInfo">
            <h2>Turn:
                <span id="turn"></span>
            </h2>
        </div>

        <div id="leftPlayerInfo">
            <h2>Left Player</h2>
            <p class="timeInfo">Time:
                <span id="leftPlayerTime"></span>
            </p>
            <p class="cpInfo"> CP:
                <span id="leftPlayerCP">0</span>
            </p>
        </div>
        <div id="rightPlayerInfo">
            <h2>Right Player</h2>
            <p class="timeInfo">Time:
                <span id="rightPlayerTime"></span>
            </p>
            <p class="cpInfo"> CP:
                <span id="rightPlayerCP">0</span>
            </p>
        </div>
    </body>
    <script type="text/javascript">
    var hostname = window.location.hostname;
    var webSocket;

    function openSocket() {
        webSocket = new WebSocket("ws://" + hostname + ":8081", "protocolOne");
        webSocket.onopen = function (evt) {
            console.log('sending ping...');
            webSocket.send('ping', '0');
        };
        webSocket.onclose = function (evt) {
            console.log(evt);
        };
        webSocket.onmessage = function (evt) {
            console.log(evt.data);

            if(evt.data === "ping") return;

            var json = JSON.parse(evt.data);

            var leftTurn = json["left"]["turn"];
            var rightTurn = json["right"]["turn"];

            var turnText = "";
            if (leftTurn == rightTurn)
                turnText = leftTurn + "B";
            else turnText = leftTurn + "A";

            document.getElementById("turn").innerText = turnText;

            document.getElementById("leftPlayerTime").innerText = json["left"]["time"];
            document.getElementById("rightPlayerTime").innerText = json["right"]["time"];

            document.getElementById("leftPlayerCP").innerText = json["left"]["cp"];
            document.getElementById("rightPlayerCP").innerText = json["right"]["cp"];
        };
        webSocket.onerror = function (evt) {
            console.log(evt);
        };
    };


    function keepAlive() {
        var timeout = 3000;
        if (webSocket.readyState == webSocket.OPEN) {
            console.log('sending ping...');
            webSocket.send('ping', timerId);
        }

        timerId = setTimeout(keepAlive, timeout);
    };
    function cancelKeepAlive() {
        if (timerId) {
            clearTimeout(timerId);
        }
    };

    openSocket();
    keepAlive();
</script>

</html>